# A new spatial data structure for triangular mesh with toroidal patches

저자: Jinyoung Choi, Kangmin Kim, Young jin park
진행상황: To-do
키워드: Bounding Volume Hierarchy

# 배경지식

2차원 자유곡선에서 효과적으로 사용된 원호 기반 BV를 3차원 기하 문제의 해결을 위한 새로운 BV로 아이디어로 확장하게 되면 2차원의 원호와 대응되는 3차원 물체의 토러스이다.  토러스는 곡률이 음과 양 뿐만 아니라 0인 부분도 있으므로 곡면의 볼록오목 여부에 영향을 받지 않고 근사할 수 있다. 또한 반지름을 조정하여 곡면을 정밀하게 근사할 수 있다. 토러스 패치를 이용하여 자유곡면을 근사하면 위치 정보 뿐만 아니라 법벡터도 유사하게 변화하므로 복잡한 자유곡면의 기하학적 정보를 간단하게 표현할 수 있다.  만약 오프셋 곡면이 입력 곡면과 동일한 종류의 곡면으로 변환된다면 별도의 시간을 들여 근사곡면을 계산하지 않아도 되므로 오프셋 곡면을 쉽게 구할 수 있다.

홀 채우기 방법을 사용하는 이유는 3D 모델링 소프트웨어나 게임 엔진에서 모델링을 할 때, 사용자가 모델링하는 도중 누락된 부분이 생길 수 있는데 홀 채우기 기술은 이러한 누락된 부분을 자동으로 메꾸어 완전한 모델을 얻을 수 있도록 도와준다.

# 단어

토로이드 (toroidal) : 원환면로부터 이를 표면으로 하는 입체는 도넛의 모양을 닮게 되는 원환체. 원을 축에 의해 회전시킨 원환면을 통해 원환체를 얻을 수 있음.

# 요약

Toroidal 패치는 정점의 미분 기하학을 사용하여 생성되며, 국소 표면을 근사화하여 기본 곡률과 방향을 추정한다. 주어진 허용 오차 내에서 정점의 인접한 면은 토로이드 패치로 효과적으로 근사화될 수 있다. 효율적인 사용을 위해, 다양한 허용 오차 값을 사용하여 토로이드 패치를 계층적으로 구성하고 전통적인 Bounding Volume Hierarchy (BVH)와 결합한다. 우리는 삼각 망에서 구멍을 메우는 데 우리의 공간 데이터 구조를 사용하는데 구멍을 메운 패치를 생성한 후, 토로이드 패치의 법선과 위치를 사용하여 구멍을 메운 패치의 정점을 업데이트합니다.

# 목적

토러스 패치에 대한 이해도를 높이기 위해서 관련 논문을 찾다보니 트로이드 패치에 대해 알게 되었다. 토러스 패치는 원환면(토러스)에 대한 패치를 사용하고 토로이드 패치는 원환체에 대한 패치를 사용하고 있다. 토러스 패치의 BVH를 사용한다면 토로이드 패치는 BVH와 토로이드 패치를 혼합하여 사용한다.

# 논문의 서론

토로이드 패치는 자유형태 표면에 대한 다양한 기하 알고리즘에 사용되어 왔다. 특히, 토로이드 패치는 각 알고리즘의 효과성과 강건성을 평가하기 위해 BVH의 리프 노드로 고려되었지만, 우리의 지식으로는 삼각 망에 대해서는 토로이드 패치가 사용된 연구가 없습니다.

토로이드 패치는 삼각 망에서 정확하게 정점과 그 주변 면을 근사하는 토로이드 패치를 공간 데이터 구조로 사용하는 것이다. 정점의 미분 기하학은 표면 적합 방법을 통해 얻을 수 있습니다. 일반적으로 토로이드 패치는 정점 주변의 삼각형을 작은 오차로 근사화하지만, 정점으로부터의 거리가 멀어질수록 근사화 정확도가 감소합니다. 따라서 주어진 허용 오차 내에서 오차가 있는 토로이드 패치를 생성하면 많은 삼각형을 소수의 토로이드 패치로 대체함으로써 3D 기하학 알고리즘의 성능을 향상시킬 수 있습니다. 

# 알고리즘

### 정점에 생성된 토로이드 패치

미분 기하학을 근사화하여 각 정점에 대한 토로이드 패치 후보를 생성하고 오차(면에서 토로이드 패치까지의 최대 거리)가 주어진 허용 범위 내에 있을 경우 매개 변수 도메인을 조정하여 인접한 면을 포함하도록 토로이드 패치 후보 집합을 확장한다. 가장 많은 면을 포괄하는 후보 중 하나의 토로이드 패치를 선택하고 이를 최종 토로이드 패치 집합에 포함시킨다. 남아있는 면이 없을 때 까지 앞에서 언급한 프로세스를 반복하고 지정된 허용 오차 값을 기반으로 계층 구조를 구축한다.

<img width="481" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-05-13_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9 11 04" src="https://github.com/Jiryeong29/3D-CAPTCHA/assets/162276293/61f0b5c5-67d8-451c-b1e3-3eaf7f945c48">

$z$축에 따라 방향이 결정된 축의 반지름 $R$ 작은 반지름 $r$

 토러스를 생성한 후, 각 정점에서 주요 곡률을 조사하여 이것이 타원체적인지 아니면 쌍곡체적인지를 결정한다. 타원체적인 표면의 경우 초기 구성은 토러스의 오목한 부분을 근사화하도록 설정되지만 쌍곡체적인 표면의 경우 토러스의 볼록한 부분을 근사화하도록 설정된다. 생성된 토러스를 기반으로 토로이드 패치는 정점을 포함하는 $(u,v)$ 의 매개 변수 영역을 적절하게 조절하여 결정된다. 그런 다음 이 패치는 인접한 면을 포함하도록 확장한다.

### 하이브리드 계층 구조 구축

하이브리드 계층 트리 구조는 하부 노드에는 토로이드 패치를, 상위 노드에는 전통적인 바운딩 볼륨을 사용한다.  전체 입력 매쉬에 허용 오차 $\epsilon = 10^{-3}$ 로 토로이드 패치를 생선한다. 이 단계를 위에 알고리즘을 통해 반복한다. 생성된 토로이드 패치의 하위 토로이드 패치의 경우, 기준은 부모 토로이드 패치의 면과 꼭짓점에 제한된다. 

토로이드 패치의 계층 구조를 구축한 후에는 최상위 토로이드 패치에 대해 전통적인 BVH 구조를 구축한다. 간단히 하기 위해 AABB를 사용하고 최상위 토로이드 패치는 AABB 안에 포함되며, 각 AABB의 중심 사이의 거리를 기반으로 두 AABB가 병합되어 부모 AABB가 생성된다. 이 절차는 전체 입력 메쉬가 하나의 AABB에 포함될 때까지 재귀적으로 반복됩니다. 그 후, 가장 가까운 AABB를 병합하여 상향식 AABB 계층 구조를 구축하고 허용 오차를 10배로 반복적으로 감소시켜 하향식 토로이드 패치를 구축합니다.

### 구명 채우기 문제에 적용

구멍 채우기 문제를 해결하기 위해 우리의 토로이드 패치 기반 하이브리드 BVH가 중요한 역할을 가진다. 이 과정은 구멍 경계 꼭짓점을 식별하는 것으로 시작하여 우리는 모든 꼭짓점을 방문하여 경계인지를 판단하는 대신 BVH구조를 사용하여 빠르게 경계 꼭짓점을 확인할 수 있다. 이러한 꼭짓점을 사용하여 기존의 구멍 채우기 알고리즘을 사용하여 초기 구멍을 채우는 패치를 생선한다. 그런 다음, 초기 구멍 채우기 패치 내의 꼭짓점 위치를 우리의 토로이드 패치를 통해 최적화하는데 이 과정은 실제 지형과 더 가까운 근사치를 달성하도록 목표한다.

구멍 패치의 전체 모양을 더 잘 추측하기 위해 입력 메쉬 내의 경계 꼭짓점의 지역 기하학적 특성을 정확하게 반영하는 토로이드 패치를 먼저 선택해야한다. 우리의 BVH 구조에는 세 종류의 토로이드 패치가 포함되어 있으며, 각각은 특정 허용 오차에 의해 정의되어 있으며, 각 꼭짓점 당 최소한 세 개의 토로이드 패치가 존재한다는 것을 의미한다. BVH 구조를 사용하여 구멍 크기에 따라 토로이드 패치의 정밀도를 조정하는 것이 가능하다. 주어진 경계 꼭짓점의 각 이웃 꼭짓점을 평가하여 이웃 꼭짓점의 법선 벡터와 토로이드 패치에서 해당 위치의 법선 벡터 사이의 가장 작은 각도 차이를 보이는 토로이드 패치를 선택한 후에  경계 꼭짓점의 법선 벡터가 선택한 토로이드 패치의 법선 벡터로 교체된다.

다음 단계는 생성된 구멍 패치의 비경계 꼭짓점의 위치와 법선 벡터를 최적화하는 것이다. 비선형 최적화 프로세스는 꼭짓점이 포함된 면의 법선 벡터와 추정된 법선 벡터 사이의 각도 차이를 최소화하기 위해 꼭짓점을 추정된 법선 벡터의 방향으로 이동시킨다. 이 과정은 구멍 패치의 경계에서부터 내부로 이동하면서 꼭짓점을 업데이트하여 꼭짓점의 위치를 조정하고 기존의 구멍 채우기 알고리즘보다 실제 지형에 더 가까운 개선된 구멍 패치를 생성합한다.

# 실험결과

이 논문에서는 제안된 데이터 구조와 구멍 채우기 알고리즘을 32GB 주 메모리를 갖춘 인텔 코어 i7-11700 2.5 GHz 윈도우 PC에서 C++로 구현했다. 또한 입력/출력 및 메쉬 연산을 쉽게 수행하기 위해 PMP 라이브러리(Sieger and Botsch, 2019)를 사용했습니다. 실험에서 사용된 3D 모델의 일관성을 유지하기 위해 모델을 대각선 길이가 1이 되도록 스케일을 조정했다.

각 모델 $\epsilon = 10^{-3},10^{-4},10^{-5}$ 에 대해 생성된 토로이드 패치로 covered된 삼각형을 나타내며, 20개의 임의의 색상으로 구분되어 허용 오차가 위에서 아래로 와 10^-5로  결과값이 나온다 일반적으로 $\epsilon$이 더 작을수록 더 많은 토로이드 패치를 의미하고 표면 수가 증가함에 따라 구축 시간도 증가한다. 일부 모델의 경우 표면은 적더라도 더 많은 시간이 소요되는데 예를 들면 부드러운 모양을 가지고 있지 않지 않다면 곡률 변화가 많기에 구축시간이 오래 걸린다.

기존의 홀 메우기 알고리즘에 데이터 구조를 적용할 때 결과의 개선 정도가 나온다. 결과를 비교하기 위해 하우스도르프 거리가 사용하였고, 네 가지 다른 홀 위치에서 측정된 평균 하우스도르프 거리를 활용했다. 대부분의 경우, 홀 메우기 패치와 그라운드 토러스 간의 하우스도르프 거리는 우리의 홀 메우기 개선 알고리즘을 사용한 후에 감소한다. 홀 경계 정점으로 생성된 토로이드 패치는 지역 곡률 정보를 함축하며, 이를 통해 홀 메우기 패치에서 보다 정확한 법선 벡터와 정점 위치를 추정할 수 있습니다.

# 결론

AABB를 상위 노드로, 토로이드 패치를 하위 노드로 하는 혼합 계층 구조를 사용하여 삼각형 메시를 표현하는 새로운 접근 방식을 제안한다. AABB 트리는 필요한 삼각형 후보를 신속하게 식별하는 데 도움을 주며, 토로이드 패치는 지역 영역의 면을 정확하게 근사화한다. 우리의 데이터 구조의 효과를 입증하기 위해 홀 채우기 문제에서 그것을 평가하는데 우리의 예상과 일관되게, 토로이드 패치는 정확한 위치를 예측하는 데 중요한 역할을 하며, 우리의 접근 방식은 기존의 홀 채우기 방법보다 오류를 성공적으로 개선합니다. 

본 논문은 삼각형 메시에 대한 토로이드 패치 기반 공간 데이터 구조의 잠재력을 처음으로 강조한 것이기 때문에, 이 문제는 향후 연구에서 우리의 데이터 구조를 적극적으로 활용하여 새로운 홀 채우기 알고리즘을 제안하는 것으로 해결될 것입니다.
