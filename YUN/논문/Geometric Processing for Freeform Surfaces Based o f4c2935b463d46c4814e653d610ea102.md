# Geometric Processing for Freeform Surfaces Based on High-Precision Torus Patch Approximation

요약: 2차원에서 자유 곡선에 대한 BVH를 생성하기 위해 원호(arc)를 기반으로 한 평면곡선을 근사하는 방법을 제안하고 이를 3차원에서 자유곡면을 토러스 패치에 근사할 수 있는 기하학적 처리 기법으로 확장하였다
저자: Myung soo Kim, Q youn Hong, Young jin park
진행상황: Completed

# 요약

2차원에서 자유 곡선에 대한 BVH를 생성하기 위해 원호(arc)를 기반으로 한 평면곡선을 근사하는 방법을 제안하고 이를 3차원에서 자유곡면을 토러스 패치에 근사할 수 있는 기하학적 처리 기법으로 확장했다.

# 목적

자유곡면에 대해 BVH를 생성하는 토러스 패치에 대한 이해도를 높이기 위함이다.

# 단어

- **BVH(Bounding Volume Hierarchy) 
:** 복잡한 물체를 간단한 도형의 집합들로 감싸 계층적 트리 구조를 만드는 바운딩 불륨 계층구조
- **토러스(Tours) 
:** 삼차원 공간 상에서 원을 포함하는 평면 위의 직선을 축으로 회전하여 만든 회전면
- **오프셋 곡면** 
: 곡면상의 각 점을 곡면의 법벡터 방향으로 일정한 거리만큼 이동시켰을 때 구해지는 곡면
- **하우스도르프 거리(Hausdorff distance)
:** 한 물체에서 다른 물체까지의 최대 편차 0에 가까울수록 두 물체가 서로 유사함
- **아핀변화**
    
     **:** 점, 직선, 평면을 보존하는 선형 매핑 방법이다 아핀 변환 후에도 평행한 선들은 평행한 상태로 유지됨
    
- bottom-up방식
    
    :상향식 접근 방법으로 세부적인 부분에서 시작하여 전체적인 그림을 완성시키는 방식
    

# 논문의 서론

2차원 자유곡선에서 효과적으로 사용된 원호 기반 BV를 3차원 기하 문제의 해결을 위한 새로운 BV로 아이디어로 확장하게 되면 2차원의 원호와 대응되는 3차원 물체의 토러스이다.  토러스는 곡률이 음과 양 뿐만 아니라 0인 부분도 있으므로 곡면의 볼록오목 여부에 영향을 받지 않고 근사할 수 있다. 또한 반지름을 조정하여 곡면을 정밀하게 근사할 수 있다. 토러스 패치를 이용하여 자유곡면을 근사하면 위치 정보 뿐만 아니라 법벡터도 유사하게 변화하므로 복잡한 자유곡면의 기하학적 정보를 간단하게 표현할 수 있다.  만약 오프셋 곡면이 입력 곡면과 동일한 종류의 곡면으로 변환된다면 별도의 시간을 들여 근사곡면을 계산하지 않아도 되므로 오프셋 곡면을 쉽게 구할 수 있다.

# 알고리즘

### 자유곡면에 대한 미분기하 계산

자유곡면 $S(u,v)$와 

1차미분한 

$$
Su Sv 
$$

2차미분한 

$$
Suu, Suv, Svv
$$

제 1차 미분형식의 값 E,F,G 단위법선벡터 **N** 제 2차 미분형식의 값 L,M,N

법곡률 $kn$은 최소값 $k1$ 최대값 $k2$가 주곡률이 되며 주곡률이 될 때의 방향 $v$는 주방향 $e1, e2$가 된다.

$$
kn=(La^2+2Mab+Nb^2)/(Ea^2+2Fab+Gb^2)
$$

가우스 곡률 $k$는 두 주곡률의 곱으로 정의된다.

### 자유곡면의 토러스 패치 생성

자유곡면을 근사하는 토러스를 생성하고 생성한 토러스 중 실제 알고리즘에서 사용할 영역을 잘라 토러스 패치를 생성한다. 자유곡면 $S(u,v)$와 토러스 근사에 사용할 자유곡면 위의 점이 주어졌을 때 자유곡면 위의 단위법선벡터, 주곡률 , 주방향을 구한다 .

$$
R=-1/k1 + 1/k2   ,     r=1/|k2|
$$

회전 축은 Z축, XY평면 위 원의 중심점까지의 거리를 큰 반지름R , 원 중심에서 토러스 곡면까지 거리인 작은 반지름r 이라할 때 일반적인 토러스(T)식

$$
T(s,t)=((R+r cos t)cos s,(R+r cos t)sin s, r sin t), (s,t) ∈[0,2π] ×[0,2π]
$$

자유평면 $S$의 성분들로 근사한 최종적인 토러스 T

$$
T(s,t)=rT(s,t)+ t,(s,t) ∈[0,2π] ×[0,2π]
$$

사용될 토러스 패치의 영역은 자유곡면 S에 대응되는 토러스 패치의 중심점 좌표는 가우스 곡률 $k$에 따라 결정된다. 토러스 내부는 가우스 곡률이 음수이고 외부의 가우스 곡률은 양수이다. 따라서 가우스 곡률이 음이 경우에는 토러스 내부, 가우스 곡률이 양인 경우에는 토러스의 외부와 대응된다. 

토러스 패치는 자유곡면$S$의 성분들을 이용하여 생성하여 국소적인 부분에서 자유 곡면을 잘 근사한다. 자유곡면 전체를 하나의 토러스 패치로 근사하면 근사오차가 커지므로 자유곡면을 매개변수 공간에서 균일한 간격으로 분할하여 자유곡면조각들을 생성한다. 자유곡면조각의 위치정보와 법벡터정보를 충분히 포함하면서도 지나치게 크지 않은 토러스 패치를 생성한다.

### 하이브리드 BVH

이 논문에서는 다양한 기하 연산을 지원하기 위해 BVH구조를 사용한다.하이브리드 BVH 구조는 사면체 BV와 토러스 패치 BVH을 동시에 사용하는 구조이다.  

BVH를 생성하는 방법은 균일한 간격으로 분할한 자유곡면조각을 기준으로 자유곡면조각에서 전체 자유곡면까지 Bottom-up 방식으로 사면체를 이용하여 생성한다. 분할된 자유곡면조각들은 개별적인 토러스 패치를 근사시키고 최대 근사오차가 근사오차한계인 $10^-6$보다 클 경우에는 그 자유곡면조각을 매개변수공간에서 각 축으로 이등분하여 4개의 자유곡면조각으로 분할한다. 분할한 4개의 자유곡면조각들을 다시 토러스 패치로 근사시키고 top-down 방식으로 이 토러스 패치들이 분할하기 전 토러스 패치와 계층적 구조를 가지게 한다. 토러스 패치의 근사오차가 근사오차한계보다 작아질 때 까지 반복한다. 단말 토러스 패치들로 형성된 토러스 패치 집합은 자유곡면 전체와 1:1로 대응된다.  

자유곡면을 자유곡면조각으로 분할할 때 큰 간격으로 분할한다면 BVH에서 사면체 BV들을 사용하는 단계가 적어진다. 자유곡면을 자유곡면조각으로 분할할 때 작은 간격으로 분할한다면 BVH에서 사면체 BV들을 사용하는 단계가 많아진다. 임의의 자유곡면이 주어졌을 때 자유곡면조각으로 분할하는 간격의 크기를 적절하게 골라야한다. 임의의 자유곡면이 주어졌을 때 자유곡면조각으로 분할하는 간격의 크기는 자유곡면의 차수,허용오차의 크기, 하이브리드 BVH가 기하 연산을 해결하는데 소요되는 시간 등을 고려하여 실험적으로 결정한다.

### 양방향 하우스도르프 거리의 상한 계산

하우스도르프 거리의 상한을 구하기 위해 이들의 최대근사오차를 먼저 계산할 필요가 있다. 이를 위해 토러스 패치가 근사하는 자유곡면상의 영역과 토러스 패치 사이의 오차를 모두 측정하고 그 최대값을 구한다. 토러스 패치에서 토러스의 국소 범위만 사용하므로 이용범위를 아래로 재매개화한다.

$$
(p,q)∈[0,1]×[0,1]
$$

$$
T(s,t)=T(s(p,q),t(p,q)),S(u,v)=S(u(p,q),v(p,q))
$$

범위가 매우 국소적이므로 계산의 편의성을 위해 (p,q),(u,v)사이의 관계를 아핀변환한다.

이를 $p,q$에 대해 편미분 하게 되면

$∂u/∂p = r0, ∂u/∂q=r1,∂v/∂p=r2,∂v/∂q=r3$

이 값은 일차미분, 이차미분으로 확장시켜  
$p,q$에 대한 미분값들을 $u,v$에 대한 미분값으로 표현할 수 있다.

$\sup_{p,q ∈ [0,1]}$ $||S(u(p,q),v(p,q))-T(s(p,q),t(p,q))≤(1/8n^2)*(M1+M2+M3)$

$$
 M1=\sup_{p,q ∈ [0,1]}||(∂^2 S(u(p,q),v(p,q)))/(∂p^2)||
$$

M1은 $s(p,q),t(p,q)$의 최대값의 차이

$$
 M2=\sup_{p,q ∈ [0,1]}||(∂^2 S(u(p,q),v(p,q)))/(∂p∂q)||
$$

M2는 $u(p,q),v(p,q)$의 최대값의 차이

$$
 M3=\sup_{p,q ∈ [0,1]}||(∂^2 S(u(p,q),v(p,q)))/(∂q^2)||
$$

M3는 $s$와 $t$ 그리고 $u$와 $v$의 차이

토러스 패치 집합상의 임의의 점에서 자유곡면까지의 최단거리는 항상 최대근사오차보다 작거나 같다. 반대로 자유곡면상의 임의의 점에서 토러스 패치 집합까지의 최단거리도 항상 최대근사오차보다 작거나 같다. 그러므로 토러스 패치 집합을 구성하는 각각의 토러스 패치와 자유곡면 사이의 양방향 하우스드로프 거리 상한은 항상 그들의 최대근사오차보다 작거나 같다.

### 오프셋 곡면 계산

토러스의 오프셋 곡면이 오목 또는 볼록의 형태는 그대로 유지되면서 곡률의 크기만 달라지기 때문에 자유곡면의 오프셋 곡면을 쉽게 구할 수 있다. 앞서 구한 토러스에서 작은 반지름에 오프셋 값을 더한 값을 $r0$이라 할 때 토러스 오프샛 곡면 $T0(s,t)$는 다음과 같이 정의한다.

$$
T0(s,t)=((R=r0 cos t)cos s,(R + r0 cos t)sin s , r0 sin t)
$$

오프셋한 토러스 패치 집합과 오프셋한 자유곡면간의 양방향 하우스도르프 거리의 상한은 입력 곡면과 토러스 패치 집합과의 양방향 하우스도르프 거리의 상한과 같다. 여기서 알 수 있는 것은 오프셋한 토러스 패치 집합의 최대근사오차를 쉽게 계산할 수 있다는 토러스 패치의 장점을 한 번 더 확인할 수 있다.

## 시험결과 하우스도르프 거리가 $10^-6$이하이다

# 결론

토러스 패치 근사 기법을 이용하여 두 자유곡면의 교차곡선을 계산하여 향후 자유곡면에 속하는 토러스 패치 간의 상관관계를 파악한다. 토러스 패치 근사 기법을 활용한다면 고정밀도의 계산을 효율적이고 안정적으로 수행할 수 있을 것이다. 이를 응용하여 오프셋 크기를 변수로 고려하여 오프셋 곡면들로 구성되는 3차원 불륨 모델링으로 결과를 확장할 수 있다. 두 자유곡면의 교차곡선과 자유곡면의 오프셋 곡면을 모델링하여 토러스 패치의 정밀 근사를 이용한 자유곡면의 기하학적 처리기법을 다양한 알고리즘에 활용할 수 있다.